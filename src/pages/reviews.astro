---
import WPPageHero from '~/components/wordpress/WPPageHero.astro';
import Layout from '~/layouts/PageLayout.astro';
import { getCollection } from 'astro:content';

const metadata = {
  title: 'Reviews â€” Mom Helper USA',
};

// Get English review posts
const allPosts = await getCollection('post');
const reviewPosts = allPosts
  .filter((post) => post.data.category === 'Reviews' && post.id.startsWith('review-'))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout metadata={metadata}>
  <!-- Hero Widget -->
  <WPPageHero title="Client Reviews" />

  <!-- Blog Post Previews -->
  <section class="px-4 py-12 mx-auto max-w-5xl">
    <h1 class="text-3xl font-bold mb-12 text-center text-gray-900 dark:text-white">Client Reviews</h1>

    <div class="space-y-12">
      {
        reviewPosts.map((post) => {
          // Extract first paragraph as excerpt
          const content = post.body || '';
          const firstParagraph = content.split('\n\n').find((p) => p.trim() && !p.startsWith('#'));
          const excerpt = firstParagraph ? firstParagraph.replace(/^##\s+/, '').substring(0, 200) + '...' : '';

          return (
            <article class="border-b border-gray-200 dark:border-gray-700 pb-12 last:border-0">
              <h2 class="text-2xl font-bold mb-4">
                <a
                  href={`/${post.slug}`}
                  class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                >
                  {post.data.title}
                </a>
              </h2>

              {excerpt && <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">{excerpt}</p>}

              <a href={`/${post.slug}`} class="text-[18px] font-medium" style="color: rgb(211, 118, 67);">
                Read More
              </a>
            </article>
          );
        })
      }
    </div>
  </section>
</Layout>
