---
import PageLayout from '~/layouts/PageLayout.astro';
import WPPageHero from '~/components/wordpress/WPPageHero.astro';
import { getCollection } from 'astro:content';

const metadata = {
  title: '이용후기 — Mom Helper USA',
  description: 'Mom Helper USA 산후관리 서비스를 이용하신 고객님들의 진솔한 후기를 확인하세요.',
};

// Get review posts - Korean only
const allPosts = await getCollection('post');
const reviewPosts = allPosts
  .filter((post) => post.data.category === 'Reviews' && !post.id.startsWith('review-'))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<PageLayout metadata={metadata}>
  <!-- Hero Widget -->
  <WPPageHero title="고객 후기" />

  <!-- Blog Post Previews -->
  <section class="px-4 py-12 mx-auto max-w-5xl">
    <h1 class="text-3xl font-bold mb-12 text-center text-gray-900 dark:text-white">고객 후기</h1>

    <div class="space-y-12">
      {
        reviewPosts.map((post) => {
          // Use excerpt from frontmatter if available, otherwise extract from content
          let excerpt = post.data.excerpt || '';

          if (!excerpt) {
            const content = post.body || '';
            const firstParagraph = content.split('\n\n').find((p) => p.trim() && !p.startsWith('#'));
            excerpt = firstParagraph ? firstParagraph.replace(/^##\s+/, '').substring(0, 200) + '...' : '';
          }

          return (
            <article class="border-b border-gray-200 dark:border-gray-700 pb-12 last:border-0">
              <h2 class="text-2xl font-bold mb-4">
                <a
                  href={`/ko/이용후기/${post.id.replace('.md', '')}`}
                  class="text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
                >
                  {post.data.title}
                </a>
              </h2>

              {excerpt && <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">{excerpt}</p>}

              <a href={`/ko/이용후기/${post.id.replace('.md', '')}`} class="text-[18px] font-medium" style="color: rgb(211, 118, 67);">
                더 읽기
              </a>
            </article>
          );
        })
      }
    </div>
  </section>
</PageLayout>
