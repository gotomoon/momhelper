---
import { APP_BLOG } from 'astrowind:config';

import { getRelatedPosts } from '~/utils/blog';
import BlogHighlightedPosts from '../widgets/BlogHighlightedPosts.astro';
import type { Post } from '~/types';
import { getBlogPermalink } from '~/utils/permalinks';
import { getLocaleFromPath, getPathForRoute } from '~/utils/i18nRoutes';

export interface Props {
  post: Post;
  locale?: 'en' | 'ko';
}

const { post, locale: propLocale } = Astro.props as Props;
const locale = propLocale === 'en' || propLocale === 'ko' ? propLocale : getLocaleFromPath(Astro.url.pathname || '/');
const blogPath = getPathForRoute('blog', locale) ?? getBlogPermalink();
const relatedPosts = post.tags ? await getRelatedPosts(post, 4) : [];
---

{
  APP_BLOG.isRelatedPostsEnabled ? (
    <BlogHighlightedPosts
      classes={{
        container:
          'pt-0 lg:pt-0 md:pt-0 intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade',
      }}
      title="Related Posts"
      linkText="View All Posts"
      linkUrl={blogPath}
      postIds={relatedPosts.map((post) => post.id)}
    />
  ) : null
}
