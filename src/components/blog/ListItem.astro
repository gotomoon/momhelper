---
import type { ImageMetadata } from 'astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';

import { APP_BLOG } from 'astrowind:config';
import type { Post } from '~/types';

import { getPermalink } from '~/utils/permalinks';
import { findImage } from '~/utils/images';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;

const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

<article
  class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 h-full flex flex-col hover:-translate-y-1 transition-transform duration-300"
>
  {
    image &&
      (link ? (
        <a class="relative block group overflow-hidden h-48" href={link ?? 'javascript:void(0)'}>
          <Image
            src={image}
            class="absolute inset-0 object-cover w-full h-full transition-transform duration-500 group-hover:scale-110"
            widths={[400, 900]}
            width={900}
            sizes="(max-width: 900px) 400px, 900px"
            alt={post.title}
            aspectRatio="16:9"
            loading="lazy"
            decoding="async"
          />
        </a>
      ) : (
        <div class="relative h-48 overflow-hidden bg-gray-400 dark:bg-slate-700">
          <Image
            src={image}
            class="absolute inset-0 object-cover w-full h-full"
            widths={[400, 900]}
            width={900}
            sizes="(max-width: 900px) 400px, 900px"
            alt={post.title}
            aspectRatio="16:9"
            loading="lazy"
            decoding="async"
          />
        </div>
      ))
  }
  <div class="p-6 flex flex-col flex-grow">
    <header>
      <div class="mb-3 text-sm text-gray-500 flex items-center gap-2">
        <Icon name="tabler:clock" class="w-3.5 h-3.5" />
        <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>
        {
          post.category && (
            <>
              <span>·</span>
              <a class="hover:text-mh-orange transition-colors" href={getPermalink(post.category.slug, 'category')}>
                {post.category.title}
              </a>
            </>
          )
        }
      </div>
      <h2 class="text-xl font-bold leading-tight mb-3 font-heading text-gray-800">
        {
          link ? (
            <a class="hover:text-mh-orange transition-colors duration-200" href={link}>
              {post.title}
            </a>
          ) : (
            post.title
          )
        }
      </h2>
    </header>

    {post.excerpt && <p class="flex-grow text-gray-600 text-base mb-4 line-clamp-3">{post.excerpt}</p>}

    <div class="mt-auto pt-4 border-t border-gray-100 flex justify-between items-center">
      <a href={link} class="text-mh-orange font-semibold text-sm hover:text-mh-orange-dark transition-colors">
        Read More →
      </a>
    </div>
  </div>
</article>
